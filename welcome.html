<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome</title>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
</head>
<body>
    <h1>Welcome to Your New Account!</h1>
    <p id="welcomeMessage"></p>
    <p id="senderMessage"></p>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA8nC973Wex5WJVgovi_MVzDtmuL4IOhjE",
            authDomain: "mandala-5165e.firebaseapp.com",
            projectId: "mandala-5165e",
            storageBucket: "mandala-5165e.appspot.com",
            messagingSenderId: "569537405023",
            appId: "1:569537405023:web:e7f795e6280f7a21e9bbea",
            measurementId: "G-TER99X7NBT"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Function to fetch user info and sender details
        auth.onAuthStateChanged(user => {
            if (user) {
                // Show welcome message with user's email
                document.getElementById("welcomeMessage").textContent = `Hello, ${user.email}! Welcome to the platform.`;

                // Fetch the inviteId associated with the user
                db.collection("users").doc(user.uid).get().then(doc => {
                    const userData = doc.data();
                    if (userData && userData.inviteId) {
                        // Fetch the sender (who sent the invite)
                        db.collection("invites").doc(userData.inviteId).get().then(inviteDoc => {
                            const inviteData = inviteDoc.data();
                            if (inviteData && inviteData.senderId) {
                                // Fetch the sender's details
                                db.collection("users").doc(inviteData.senderId).get().then(senderDoc => {
                                    const senderData = senderDoc.data();
                                    document.getElementById("senderMessage").textContent = `You were invited by: ${senderData.email}`;
                                }).catch(err => {
                                    console.error("Error fetching sender details:", err);
                                });
                            }
                        }).catch(err => {
                            console.error("Error fetching invite details:", err);
                        });
                    }
                }).catch(err => {
                    console.error("Error fetching user data:", err);
                });
            } else {
                // If not authenticated, redirect to sign-up page
                window.location.href = '/index.html';
            }
        });
    </script>
</body>
</html>
