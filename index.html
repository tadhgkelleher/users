<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cosmic Mandala Generator - 3D Version</title>
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      text-align: center;
      background-color: #0a0a0a;
      color: #ccc;
      margin: 0;
      padding: 20px;
      transition: background-color 0.5s, color 0.5s;
      overflow-x: hidden;
    }

    h1 {
      margin-bottom: 20px;
      color: #a0f;
      text-shadow: 0 0 15px rgba(170, 0, 255, 0.5);
      font-size: 3rem;
      letter-spacing: 1px;
    }

    canvas {
      border: 3px solid #333;
      margin: 20px auto;
      display: block;
      background-color: #111;
      box-shadow: 5px 5px 30px rgba(0, 0, 0, 0.7);
      border-radius: 15px;
      transition: box-shadow 0.3s;
    }

    canvas:hover {
      box-shadow: 0 0 30px rgba(173, 216, 230, 0.6);
    }

    .controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }

    .control-panel {
      background-color: #181818;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s;
    }

    button, select {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background-color: #7c4dff;
      color: #fff;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
    }

    button:hover, select:hover {
      background-color: #6a3ab5;
      transform: translateY(-3px);
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    input[type="number"], input[type="range"] {
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: #2a2a2a;
      color: #eee;
      width: 75px;
      outline: none;
    }

    input[type="color"] {
      width: 50px;
      height: 30px;
      padding: 5px;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      cursor: pointer;
      border: 3px solid #444;
      border-radius: 6px;
    }

    input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 5px;
    }

    .parameter_input {
      padding: 8px;
      margin: 12px;
      position: relative;
      transition: transform 0.2s;
    }

    .parameter_input:hover {
      transform: scale(1.05);
    }

    label {
      color: #b39ddb;
      display: block;
      margin-bottom: 6px;
      font-size: 15px;
    }

    .color-palette {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-top: 18px;
    }

    .color-option {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid #555;
      transition: transform 0.2s, border 0.2s;
    }

    .color-option:hover {
      transform: scale(1.2);
      border: 3px solid #fff;
    }

    .button-group {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }

    .tooltip {
      position: absolute;
      top: -35px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #444;
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      white-space: nowrap;
      z-index: 10;
    }

    .parameter_input:hover .tooltip {
      opacity: 1;
    }

    .tab-container {
      margin-bottom: 18px;
    }

    .tab {
      padding: 10px 20px;
      margin: 0 6px;
      background-color: #444;
      border: none;
      border-radius: 6px 6px 0 0;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: background-color 0.3s, color 0.3s;
    }

    .tab.active {
      background-color: #7c4dff;
      color: white;
    }

    .tab-content {
      display: none;
      padding: 20px;
      background-color: #181818;
      border-radius: 0 0 12px 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .tab-content.active {
      display: block;
    }

    .animation-controls {
      margin: 20px 0;
    }

    @keyframes pulse {
      0% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.05); }
      100% { opacity: 0.6; transform: scale(1); }
    }

    .pulsate {
      animation: pulse 2.5s infinite ease-in-out;
    }

    .theme-option {
      display: inline-block;
      width: 30px;
      height: 30px;
      margin: 0 6px;
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid #555;
      transition: border 0.3s;
    }

    .gallery {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 25px;
    }

    .gallery-item {
      width: 175px;
      height: 175px;
      border: 3px solid #555;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .gallery-item:hover {
      transform: scale(1.1);
    }

    .preset-container {
      margin: 20px 0;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
    }

    .preset-btn {
      background-color: #3f51b5;
      padding: 10px 18px;
      font-size: 15px;
    }

    #download {
      background-color: #5c6bc0;
    }

    #download:hover {
      background-color: #455a64;
    }

    #random {
      background-color: #9c27b0;
    }

    #random:hover {
      background-color: #7b1fa2;
    }

    #animate {
      background-color: #d32f2f;
    }

    #animate:hover {
      background-color: #c62828;
    }

    #vrButton {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 24px;
      font-size: 17px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      z-index: 100;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    #vrButton:hover {
      background-color: #43a047;
      transform: translateY(-2px);
    }

    #vrButton:active {
      transform: translateY(0);
    }

    #frequencyControls {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }

    #frequencyControls label {
      margin-bottom: 5px;
    }

    #frequencyControls input[type="range"] {
      width: 200px;
      margin-bottom: 10px;
    }

    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
        align-items: center;
      }

      .parameter_input {
        text-align: left;
      }

      canvas {
        max-width: 100%;
        height: auto;
      }

      #vrButton {
        bottom: 10px;
        right: 10px;
        padding: 8px 16px;
        font-size: 14px;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <h1>Cosmic Mandala Generator</h1>

  <div class="tab-container">
    <button class="tab active" onclick="openTab(event, 'basicTab')">Basic</button>
    <button class="tab" onclick="openTab(event, 'advancedTab')">Advanced</button>
    <button class="tab" onclick="openTab(event, 'themeTab')">Themes</button>
    <button class="tab" onclick="openTab(event, 'spiritualTab')">Spiritual</button>
  </div>

  <div id="basicTab" class="tab-content active">
    <div class="control-panel">
      <div class="controls">
        <div class="parameter_input">
          <span class="tooltip">Number of radial segments</span>
          <label for="segments">Segments</label>
          <input type="range" id="segments" value="12" min="3" max="36" oninput="updateValue('segments')">
          <span id="segments-value">12</span>
        </div>
        <div class="parameter_input">
          <span class="tooltip">Recursion depth</span>
          <label for="levels">Levels</label>
          <input type="range" id="levels" value="4" min="1" max="8" oninput="updateValue('levels')">
          <span id="levels-value">4</span>
        </div>
        <div class="parameter_input">
          <span class="tooltip">Size reduction factor</span>
          <label for="scaleFactor">Scale</label>
          <input type="range" id="scaleFactor" value="0.5" min="0.1" max="0.9" step="0.05" oninput="updateValue('scaleFactor')">
          <span id="scaleFactor-value">0.5</span>
        </div>
        <div class="parameter_input">
          <span class="tooltip">Starting radius</span>
          <label for="initialRadius">Radius</label>
          <input type="range" id="initialRadius" value="100" min="10" max="200" oninput="updateValue('initialRadius')">
          <span id="initialRadius-value">100</span>
        </div>
        <div class="parameter_input">
          <span class="tooltip">Primary color</span>
          <label for="lineColor">Color</label>
          <input type="color" id="lineColor" value="#ffffff">
        </div>
      </div>
    </div>

    <div class="preset-container">
      <button class="preset-btn" onclick="loadPreset('floral')">Floral</button>
      <button class="preset-btn" onclick="loadPreset('star')">Star</button>
      <button class="preset-btn" onclick="loadPreset('crystal')">Crystal</button>
      <button class="preset-btn" onclick="loadPreset('cosmic')">Cosmic</button>
      <button class="preset-btn" onclick="loadPreset('psychedelic')">Psychedelic</button>
    </div>
  </div>

  <div id="advancedTab" class="tab-content">
    <div class="control-panel">
      <div class="controls">
        <div class="parameter_input">
          <span class="tooltip">Thickness of lines</span>
          <label for="lineWidth">Line Width</label>
          <input type="range" id="lineWidth" value="1" min="0.5" max="5" step="0.5" oninput="updateValue('lineWidth')">
          <span id="lineWidth-value">1</span>
        </div>
        <div class="parameter_input">
          <span class="tooltip">Rotation angle of the mandala</span>
          <label for="rotation">Rotation</label>
          <input type="range" id="rotation" value="0" min="0" max="360" oninput="updateValue('rotation')">
          <span id="rotation-value">0°</span>
        </div>
        <div class="parameter_input">
          <span class="tooltip">Style of line endings</span>
          <label for="lineCap">Line Style</label>
          <select id="lineCap">
            <option value="round">Round</option>
            <option value="butt">Flat</option>
            <option value="square">Square</option>
          </select>
        </div>
        <div class="parameter_input">
          <span class="tooltip">Secondary color for gradient</span>
          <label for="secondaryColor">2nd Color</label>
          <input type="color" id="secondaryColor" value="#ff6347">
        </div>
        <div class="parameter_input">
          <span class="tooltip">Pattern variation</span>
          <label for="patternType">Pattern</label>
          <select id="patternType">
            <option value="circles">Circles</option>
            <option value="triangles">Triangles</option>
            <option value="squares">Squares</option>
            <option value="mixed">Mixed</option>
            <option value="stars">Stars</option>
            <option value="waves">Waves</option>
          </select>
        </div>
      </div>
    </div>

    <div class="animation-controls">
      <button id="animate">Animate</button>
      <select id="animationType">
        <option value="rotate">Rotate</option>
        <option value="pulse">Pulse</option>
        <option value="evolve">Evolve</option>
        <option value="colorShift">Color Shift</option>
        <option value="complex">Complex</option>
      </select>
    </div>
  </div>

  <div id="themeTab" class="tab-content">
    <div class="control-panel">
      <h3>Color Themes</h3>
      <div class="color-palette">
        <div class="color-option" style="background: linear-gradient(45deg, #ff6347, #ff8c69);" onclick="setColorTheme('#ff6347', '#ff8c69')"></div>
        <div class="color-option" style="background: linear-gradient(45deg, #4682b4, #87ceeb);" onclick="setColorTheme('#4682b4', '#87ceeb')"></div>
        <div class="color-option" style="background: linear-gradient(45deg, #9932cc, #da70d6);" onclick="setColorTheme('#9932cc', '#da70d6')"></div>
        <div class="color-option" style="background: linear-gradient(45deg, #3cb371, #98fb98);" onclick="setColorTheme('#3cb371', '#98fb98')"></div>
        <div class="color-option" style="background: linear-gradient(45deg, #ffd700, #ffffe0);" onclick="setColorTheme('#ffd700', '#ffffe0')"></div>
        <div class="color-option" style="background: linear-gradient(45deg, #ff4500, #ffa07a);" onclick="setColorTheme('#ff4500', '#ffa07a')"></div>
        <div class="color-option" style="background: linear-gradient(45deg, #00ced1, #afeeee);" onclick="setColorTheme('#00ced1', '#afeeee')"></div>
        <div class="color-option" style="background: linear-gradient(45deg, #9400d3, #ee82ee);" onclick="setColorTheme('#9400d3', '#ee82ee')"></div>
        <div class="color-option" style="background: linear-gradient(45deg, #000000, #333333);" onclick="setColorTheme('#000000', '#333333')"></div>
        <div class="color-option" style="background: linear-gradient(45deg, #2980b9, #6dd5fa);" onclick="setColorTheme('#2980b9', '#6dd5fa')"></div>
        <div class="color-option" style="background: linear-gradient(45deg, #8e44ad, #c0392b);" onclick="setColorTheme('#8e44ad', '#c0392b')"></div>
      </div>

      <h3>Background Themes</h3>
      <div class="theme-option" style="background-color: #0a0a0a;" onclick="setTheme('#0a0a0a', '#ccc')"></div>
      <div class="theme-option" style="background-color: #1a2639;" onclick="setTheme('#1a2639', '#eee')"></div>
      <div class="theme-option" style="background-color: #231b1b;" onclick="setTheme('#231b1b', '#eee')"></div>
      <div class="theme-option" style="background-color: #22333b;" onclick="setTheme('#22333b', '#eee')"></div>
      <div class="theme-option" style="background-color: #f5f5f5;" onclick="setTheme('#f5f5f5', '#333')"></div>
      <div class="theme-option" style="background-image: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YmVhY2h8ZW58MHx8MHx8fDA%3D&w=1000&q=80'); background-size: cover;" onclick="setTheme('url(https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8YmVhY2h8ZW58MHx8MHx8fDA%3D&w=1000&q=80)', '#333')"></div>
      <div class="theme-option" style="background-image: url('https://images.unsplash.com/photo-1503366514048-11e02d95a5c8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8bmVidWxhfGVufDB8fDB8fHww&w=1000&q=80'); background-size: cover;" onclick="setTheme('url(https://images.unsplash.com/photo-1503366514048-11e02d95a5c8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8bmVidWxhfGVufDB8fDB8fHww&w=1000&q=80)', '#eee')"></div>
    </div>
  </div>

  <div id="spiritualTab" class="tab-content">
    <div class="control-panel">
      <h3>VR Experience</h3>
      <p>Enter a fully immersive VR experience with your mandala.</p>
      <button id="vrButton">Enter VR Mode</button>

      <h3>Frequency Generator</h3>
      <div id="frequencyControls">
        <label for="frequency">Binaural Beat Frequency (Hz):</label>
        <input type="range" id="frequency" min="1" max="40" value="7.83" step="0.01">
        <span id="frequencyValue">7.83 Hz</span>
        <p><i>Currently set to <span id="brainwaveState">Schumann Resonance</span>.</i></p>
      </div>
    </div>
  </div>

  <div class="button-group">
    <button id="generate">Generate</button>
    <button id="random">Random</button>
    <button id="download">Download</button>
  </div>

  <canvas id="mandalaCanvas" width="600" height="600"></canvas>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script>
    const canvas = document.getElementById('mandalaCanvas');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
    renderer.setSize(canvas.width, canvas.height);
    renderer.setClearColor(0x000000);
    const particleCount = 5000;
    const particles = new THREE.BufferGeometry();
    const positions = new Float32Array(particleCount * 3);
    const colors = new Float32Array(particleCount * 3);
    const vortexRadius = 5;
    const vortexHeight = 10;
    const spiralStrength = 2;

    for (let i = 0; i < particleCount; i++) {
        const i3 = i * 3;
        const angle = Math.random() * Math.PI * 2;
        const radius = Math.random() * vortexRadius;
        const height = (Math.random() - 0.5) * vortexHeight;
        positions[i3 + 0] = radius * Math.cos(angle);
        positions[i3 + 1] = height + spiralStrength * Math.sin(radius * 5);
        positions[i3 + 2] = radius * Math.sin(angle);
        const color = new THREE.Color(Math.random(), Math.random(), Math.random());
        colors[i3 + 0] = color.r;
        colors[i3 + 1] = color.g;
        colors[i3 + 2] = color.b;
    }

    particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    particles.setAttribute('color', new THREE.BufferAttribute(colors, 3));

    const particleMaterial = new THREE.PointsMaterial({
        size: 0.05,
        vertexColors: true,
        transparent: true,
        opacity: 0.7
    });

    const particleSystem = new THREE.Points(particles, particleMaterial);
    scene.add(particleSystem);

    camera.position.z = 15;

    // Audio
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillatorLeft = audioContext.createOscillator();
    const oscillatorRight = audioContext.createOscillator();
    const gainNodeLeft = audioContext.createGain();
    const gainNodeRight = audioContext.createGain();

    oscillatorLeft.connect(gainNodeLeft);
    oscillatorRight.connect(gainNodeRight);
    gainNodeLeft.connect(audioContext.destination);
    gainNodeRight.connect(audioContext.destination);

    oscillatorLeft.type = 'sine';
    oscillatorRight.type = 'sine';

    gainNodeLeft.gain.value = 0.5;
    gainNodeRight.gain.value = 0.5;

    oscillatorLeft.start();
    oscillatorRight.start();

    const frequencySlider = document.getElementById('frequency');
    const frequencyValueDisplay = document.getElementById('frequencyValue');
    const brainwaveStateDisplay = document.getElementById('brainwaveState');

    frequencySlider.addEventListener('input', function() {
      const baseFrequency = 200;
      const beatFrequency = parseFloat(this.value);
      const leftFrequency = baseFrequency - beatFrequency / 2;
      const rightFrequency = baseFrequency + beatFrequency / 2;

      oscillatorLeft.frequency.setValueAtTime(leftFrequency, audioContext.currentTime);
      oscillatorRight.frequency.setValueAtTime(rightFrequency, audioContext.currentTime);
      frequencyValueDisplay.textContent = beatFrequency.toFixed(2) + ' Hz';

      let state = '';
      if (beatFrequency >= 0.5 && beatFrequency < 4) {
        state = 'Delta (Deep Sleep/Healing)';
      } else if (beatFrequency >= 4 && beatFrequency < 8) {
        state = 'Theta (Meditation/Creativity)';
      } else if (beatFrequency >= 7 && beatFrequency < 13) {
        state = 'Alpha (Relaxation/Awareness)';
      } else if (beatFrequency >= 12 && beatFrequency < 30) {
        state = 'Beta (Alertness/Focus)';
      } else if (beatFrequency >= 30) {
        state = 'Gamma (Insight/Information Processing)';
      } else {
        state = 'Schumann Resonance (Earth\'s Natural Frequency)';
      }

      brainwaveStateDisplay.textContent = state;
    });

    frequencySlider.dispatchEvent(new Event('input'));

    // Animation Loop
    let animationFrame = 0;
    function animate() {
        requestAnimationFrame(animate);

        // Subtle Rotation of the entire vortex
        particleSystem.rotation.y += 0.001;
        particleSystem.rotation.x += 0.0005;

        // Vortex evolution synched to sound
        animationFrame++;
        const beatFrequency = parseFloat(frequencySlider.value);
        const scaleFactor = 0.5 + 0.3 * Math.sin(animationFrame * 0.02 + beatFrequency * 0.1);
        particleSystem.scale.set(scaleFactor, scaleFactor, scaleFactor);

        const vortexColor = new THREE.Color(`hsl(${(animationFrame * 0.5) % 360}, 100%, 50%)`);
        particleMaterial.color.copy(vortexColor);
        particleMaterial.needsUpdate = true;

        renderer.render(scene, camera);
    }

    // Tab Functionality
    function openTab(evt, tabName) {
      const tabcontent = document.getElementsByClassName("tab-content");
      for (let i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove("active");
      }

      const tablinks = document.getElementsByClassName("tab");
      for (let i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove("active");
      }

      document.getElementById(tabName).classList.add("active");
      evt.currentTarget.classList.add("active");
    }
     // Theme Functionality
    function setColorTheme(primary, secondary) {
      // Placeholder for 3D color changes
      console.log("Color theme set to:", primary, secondary);
      // TODO: Implement 3D material color changes here
    }

    function setTheme(bg, text) {
      document.body.style.backgroundColor = bg;
      document.body.style.color = text;
      // Placeholder for 3D scene background change
      console.log("Theme set to:", bg, text);
      // TODO: Implement 3D scene background change
    }

    // Update Value Displays (Placeholder)
    function updateValueDisplays() {
      // TODO: Implement UI element value updates if needed for Three.js
    }

    // Update Value (Placeholder)
    function updateValue(id) {
      // TODO: Connect UI input elements to Three.js scene parameters
    }

    // Preset Loading (Placeholder)
    function loadPreset(type) {
      // TODO: Implement 3D scene preset loading
    }

    // Download Functionality (Placeholder)
    function downloadMandala() {
      // TODO: Implement 3D scene download/export
      alert("Download functionality not yet implemented for 3D.");
    }

    // VR Button (Placeholder)
    document.getElementById('vrButton').addEventListener('click', function() {
      alert('VR Mode not yet implemented. Imagine a serene, immersive experience!');
    });

    // Generate, Random, Animate Buttons (Placeholders)
    document.getElementById('generate').addEventListener('click', function() {
      // TODO: Trigger 3D scene generation with current parameters
      console.log("Generate button clicked");
    });

    document.getElementById('random').addEventListener('click', function() {
      // TODO: Randomize 3D scene parameters
      console.log("Random button clicked");
    });

    document.getElementById('animate').addEventListener('click', function() {
        // TODO: Implement animation toggling for 3D scene
        console.log("Animate button clicked");
    });

    animate();
  </script>
</body>
</html>
